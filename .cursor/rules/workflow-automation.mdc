# Workflow Automation Rules

## Má»¥c tiÃªu

Tá»± Ä‘á»™ng hÃ³a thao tÃ¡c code vÃ  sá»­ dá»¥ng cÃ´ng cá»¥ há»£p lÃ½, tÃ¡ch rÃµ 2 cháº¿ Ä‘á»™:

- **Simple Mode**: Tá»± Ä‘á»™ng hÃ³a cao cho task nhá»
- **Guarded Mode**: XÃ¡c minh trÆ°á»›c cho task phá»©c táº¡p

---

## Cháº¿ Ä‘á»™ 1: Simple Mode (Tá»± Ä‘á»™ng hÃ³a cao)

### âœ… ÄÆ°á»£c phÃ©p khi:

- ThÃªm/sá»­a UI components, props, state
- Gá»i API Ä‘Æ¡n giáº£n (CRUD cÆ¡ báº£n)
- Refactor nhá»: Ä‘á»•i tÃªn biáº¿n, tÃ¡ch hÃ m, cleanup code
- ThÃªm file má»›i vÃ o Ä‘Ãºng folder convention
- Sá»­a â‰¤ 3 file cÃ¹ng lÃºc
- KhÃ´ng thay Ä‘á»•i API contract, database schema, auth logic

### ğŸ› ï¸ CÃ´ng cá»¥ Ä‘Æ°á»£c phÃ©p:

- `edit_file` - thay Ä‘á»•i nhá»
- `search_replace` - file > 2500 dÃ²ng
- `codebase_search` - tÃ¬m hiá»ƒu context
- Show code trá»±c tiáº¿p, khÃ´ng cáº§n há»i trÆ°á»›c
- "Action before explanation" Ä‘Æ°á»£c phÃ©p

### ğŸ“ VÃ­ dá»¥ Simple Mode:

```typescript
// âœ… ThÃªm prop má»›i cho component
interface ButtonProps {
  variant?: "primary" | "secondary";
  size?: "sm" | "md" | "lg";
  // ThÃªm prop má»›i
  loading?: boolean;
}

// âœ… Refactor nhá» - tÃ¡ch hÃ m
const handleSubmit = async (data: FormData) => {
  const validatedData = validateFormData(data);
  await submitToAPI(validatedData);
};

// âœ… ThÃªm helper function
export const formatDate = (date: Date): string => {
  return new Intl.DateTimeFormat("vi-VN").format(date);
};
```

### âš ï¸ LÆ°u Ã½:

- TuÃ¢n theo `commands.mdc` náº¿u dÃ¹ng `run_terminal_cmd`
- KhÃ´ng gá»i nhiá»u command liÃªn tiáº¿p
- KhÃ´ng gá»i `npm run build/test` trá»« khi fix lá»—i
- Tá»± Ä‘á»™ng cháº¡y lint/format sau edit

---

## Cháº¿ Ä‘á»™ 2: Guarded Mode (XÃ¡c minh trÆ°á»›c)

### ğŸš¨ Pháº£i chuyá»ƒn sang Guarded Mode khi:

- CÃ³ > 1 hÆ°á»›ng triá»ƒn khai
- Thay Ä‘á»•i API routes, database schema, business logic, auth
- ThÃªm thÆ° viá»‡n má»›i
- Thay Ä‘á»•i folder structure (di chuyá»ƒn/Ä‘á»•i tÃªn folder)
- Thay Ä‘á»•i `.env`, config há»‡ thá»‘ng
- Sá»­a > 3 file cÃ¹ng lÃºc
- áº¢nh hÆ°á»Ÿng performance Ä‘Ã¡ng ká»ƒ

### ğŸ”’ Quy táº¯c Guarded Mode:

- **KHÃ”NG Ä‘Æ°á»£c code ngay**
- Pháº£i phÃ¢n tÃ­ch yÃªu cáº§u báº±ng text-only
- Chá» xÃ¡c nháº­n ngÆ°á»i dÃ¹ng trÆ°á»›c khi code
- **KHÃ”NG dÃ¹ng báº¥t ká»³ tool nÃ o** (edit_file, search_replace, terminal)

### ğŸ“‹ Template phÃ¢n tÃ­ch:

```
**PhÃ¢n tÃ­ch yÃªu cáº§u:**
- Hiá»‡n táº¡i: [mÃ´ táº£ state hiá»‡n táº¡i]
- Äá» xuáº¥t: [giáº£i phÃ¡p cá»¥ thá»ƒ]
- TÃ¡c Ä‘á»™ng: [file nÃ o, logic nÃ o bá»‹ áº£nh hÆ°á»Ÿng]
- Alternative: [cÃ¡c option khÃ¡c náº¿u cÃ³]

**Implementation Plan:**
1. Frontend: [thay Ä‘á»•i gÃ¬]
2. Backend: [thay Ä‘á»•i gÃ¬]
3. Database: [náº¿u cÃ³]
4. Breaking changes: [náº¿u cÃ³]

**XÃ¡c nháº­n:** Báº¡n cÃ³ Ä‘á»“ng Ã½ vá»›i approach nÃ y khÃ´ng?
```

### ğŸ“ VÃ­ dá»¥ Guarded Mode:

```typescript
// âŒ KHÃ”NG Ä‘Æ°á»£c tá»± Ä‘á»™ng thÃªm thÆ° viá»‡n má»›i
npm install @tanstack/react-query

// âŒ KHÃ”NG Ä‘Æ°á»£c tá»± Ä‘á»™ng thay Ä‘á»•i API contract
// CÅ©: GET /api/users
// Má»›i: GET /api/users?page=1&limit=10

// âŒ KHÃ”NG Ä‘Æ°á»£c tá»± Ä‘á»™ng thay Ä‘á»•i auth logic
const isAuthenticated = (user: User) => {
  // Thay Ä‘á»•i logic authentication
}
```

---

## Luáº­t sá»­ dá»¥ng cÃ´ng cá»¥

### Æ¯u tiÃªn thá»© tá»±:

1. `edit_file` - thay Ä‘á»•i nhá», file < 2500 dÃ²ng
2. `search_replace` - file > 2500 dÃ²ng, thay Ä‘á»•i pattern
3. `codebase_search` - tÃ¬m hiá»ƒu context, chÆ°a rÃµ codebase
4. `run_terminal_cmd` - chá»‰ khi khÃ´ng cÃ²n lá»±a chá»n khÃ¡c

### Checklist trÆ°á»›c khi dÃ¹ng tool:

- [ ] ÄÃ¢y lÃ  task Ä‘Æ¡n giáº£n hay phá»©c táº¡p?
- [ ] CÃ³ cáº§n xÃ¡c nháº­n tá»« ngÆ°á»i dÃ¹ng khÃ´ng?
- [ ] CÃ³ thá»ƒ gÃ¢y áº£nh hÆ°á»Ÿng Ä‘áº¿n há»‡ thá»‘ng khÃ´ng?
- [ ] Output tá»« lá»‡nh trÆ°á»›c Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ chÆ°a?

---

## Rollback Strategy

### Náº¿u Simple Mode gÃ¢y lá»—i:

```bash
# Undo nhanh
git checkout -- <file_path>
git restore <file_path>

# Hoáº·c revert commit
git revert HEAD

# Cháº¡y lint/format Ä‘á»ƒ fix
npm run lint --fix
npm run format
```

### Best Practices:

- Commit thÆ°á»ng xuyÃªn trÆ°á»›c khi thao tÃ¡c tá»± Ä‘á»™ng
- Test nhanh sau má»—i thay Ä‘á»•i
- CÃ³ backup/checkpoint trÆ°á»›c khi thay Ä‘á»•i lá»›n

---

## Success Metrics

âœ… **ThÃ nh cÃ´ng khi:**

- Task nhá» Ä‘Æ°á»£c xá»­ lÃ½ nhanh, Ä‘Ãºng
- Task phá»©c táº¡p luÃ´n Ä‘Æ°á»£c xÃ¡c minh trÆ°á»›c
- KhÃ´ng cÃ³ thay Ä‘á»•i báº¥t ngá» gÃ¢y lá»—i
- Cursor khÃ´ng phÃ¡ vá»¡ logic tá»•ng thá»ƒ
- Code quality Ä‘Æ°á»£c maintain (lint/format tá»± Ä‘á»™ng)

Cursor khÃ´ng phÃ¡ vá»¡ logic tá»•ng thá»ƒ vÃ¬ hÃ nh Ä‘á»™ng vá»™i vÃ ng
