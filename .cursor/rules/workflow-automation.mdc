---
alwaysApply: true
---
## Cháº¿ Ä‘á»™ 2: Guarded Mode (XÃ¡c minh trÆ°á»›c)

### ğŸš¨ Pháº£i chuyá»ƒn sang Guarded Mode khi:

- CÃ³ > 1 hÆ°á»›ng triá»ƒn khai
- Thay Ä‘á»•i API routes, database schema, business logic, auth
- ThÃªm thÆ° viá»‡n má»›i
- Thay Ä‘á»•i folder structure (di chuyá»ƒn/Ä‘á»•i tÃªn folder)
- Thay Ä‘á»•i `.env`, config há»‡ thá»‘ng
- Sá»­a > 3 file cÃ¹ng lÃºc
- áº¢nh hÆ°á»Ÿng performance Ä‘Ã¡ng ká»ƒ

### ğŸ”’ Quy táº¯c Guarded Mode:

- **KHÃ”NG Ä‘Æ°á»£c code ngay**
- Pháº£i phÃ¢n tÃ­ch yÃªu cáº§u báº±ng text-only
- Chá» xÃ¡c nháº­n ngÆ°á»i dÃ¹ng trÆ°á»›c khi code
- **KHÃ”NG dÃ¹ng báº¥t ká»³ tool nÃ o** (edit_file, search_replace, terminal)

### ğŸ“‹ Template phÃ¢n tÃ­ch:

```
**PhÃ¢n tÃ­ch yÃªu cáº§u:**
- Hiá»‡n táº¡i: [mÃ´ táº£ state hiá»‡n táº¡i]
- Äá» xuáº¥t: [giáº£i phÃ¡p cá»¥ thá»ƒ]
- TÃ¡c Ä‘á»™ng: [file nÃ o, logic nÃ o bá»‹ áº£nh hÆ°á»Ÿng]
- Alternative: [cÃ¡c option khÃ¡c náº¿u cÃ³]

**Implementation Plan:**
1. Frontend: [thay Ä‘á»•i gÃ¬]
2. Backend: [thay Ä‘á»•i gÃ¬]
3. Database: [náº¿u cÃ³]
4. Breaking changes: [náº¿u cÃ³]

**XÃ¡c nháº­n:** Báº¡n cÃ³ Ä‘á»“ng Ã½ vá»›i approach nÃ y khÃ´ng?
```

### ğŸ“ VÃ­ dá»¥ Guarded Mode:

```typescript
// âŒ KHÃ”NG Ä‘Æ°á»£c tá»± Ä‘á»™ng thÃªm thÆ° viá»‡n má»›i
npm install @tanstack/react-query

// âŒ KHÃ”NG Ä‘Æ°á»£c tá»± Ä‘á»™ng thay Ä‘á»•i API contract
// CÅ©: GET /api/users
// Má»›i: GET /api/users?page=1&limit=10

// âŒ KHÃ”NG Ä‘Æ°á»£c tá»± Ä‘á»™ng thay Ä‘á»•i auth logic
const isAuthenticated = (user: User) => {
  // Thay Ä‘á»•i logic authentication
}
```

---

## Luáº­t sá»­ dá»¥ng cÃ´ng cá»¥

### Æ¯u tiÃªn thá»© tá»±:

1. `edit_file` - thay Ä‘á»•i nhá», file < 2500 dÃ²ng
2. `search_replace` - file > 2500 dÃ²ng, thay Ä‘á»•i pattern
3. `codebase_search` - tÃ¬m hiá»ƒu context, chÆ°a rÃµ codebase
4. `run_terminal_cmd` - chá»‰ khi khÃ´ng cÃ²n lá»±a chá»n khÃ¡c

### Checklist trÆ°á»›c khi dÃ¹ng tool:

- [ ] ÄÃ¢y lÃ  task Ä‘Æ¡n giáº£n hay phá»©c táº¡p?
- [ ] CÃ³ cáº§n xÃ¡c nháº­n tá»« ngÆ°á»i dÃ¹ng khÃ´ng?
- [ ] CÃ³ thá»ƒ gÃ¢y áº£nh hÆ°á»Ÿng Ä‘áº¿n há»‡ thá»‘ng khÃ´ng?
- [ ] Output tá»« lá»‡nh trÆ°á»›c Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ chÆ°a?

---

## Rollback Strategy

### Náº¿u Simple Mode gÃ¢y lá»—i:

```bash
# Undo nhanh
git checkout -- <file_path>
git restore <file_path>

# Hoáº·c revert commit
git revert HEAD

# Cháº¡y lint/format Ä‘á»ƒ fix
npm run lint --fix
npm run format
```

### Best Practices:

- Commit thÆ°á»ng xuyÃªn trÆ°á»›c khi thao tÃ¡c tá»± Ä‘á»™ng
- Test nhanh sau má»—i thay Ä‘á»•i
- CÃ³ backup/checkpoint trÆ°á»›c khi thay Ä‘á»•i lá»›n

---

## Success Metrics

âœ… **ThÃ nh cÃ´ng khi:**

- Task nhá» Ä‘Æ°á»£c xá»­ lÃ½ nhanh, Ä‘Ãºng
- Task phá»©c táº¡p luÃ´n Ä‘Æ°á»£c xÃ¡c minh trÆ°á»›c
- KhÃ´ng cÃ³ thay Ä‘á»•i báº¥t ngá» gÃ¢y lá»—i
- Cursor khÃ´ng phÃ¡ vá»¡ logic tá»•ng thá»ƒ
- Code quality Ä‘Æ°á»£c maintain (lint/format tá»± Ä‘á»™ng)

Cursor khÃ´ng phÃ¡ vá»¡ logic tá»•ng thá»ƒ vÃ¬ hÃ nh Ä‘á»™ng vá»™i vÃ ng
